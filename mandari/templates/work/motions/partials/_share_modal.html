<!-- Share Modal (Google Drive Style) -->
<div x-show="showShareModal"
     x-transition:enter="transition ease-out duration-200"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-150"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0"
     class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"
     @click.self="closeShareModal()"
     @keydown.escape.window="closeShareModal()">
    <div x-show="showShareModal"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         class="bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md overflow-hidden">

        <!-- Header -->
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Dokument teilen</h3>
                <button @click="closeShareModal()"
                        class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1" x-text="shareMotionTitle"></p>
        </div>

        <!-- Body -->
        <form :action="`/work/{{ organization.slug }}/motions/${shareMotionId}/share/update/`"
              method="post"
              hx-post
              :hx-post="`/work/{{ organization.slug }}/motions/${shareMotionId}/share/update/`"
              hx-swap="none">
            {% csrf_token %}
            <div class="p-6 space-y-4">
                <!-- Visibility Options -->
                <div class="space-y-3">
                    <!-- Private -->
                    <label class="flex items-start gap-3 p-3 rounded-xl border cursor-pointer transition-all"
                           :class="shareVisibility === 'private'
                               ? 'border-primary-500 bg-primary-50 dark:bg-primary-900/20'
                               : 'border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750'">
                        <input type="radio" name="visibility" value="private"
                               x-model="shareVisibility"
                               class="mt-0.5 text-primary-600 focus:ring-primary-500">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <i data-lucide="lock" class="w-4 h-4 text-gray-500"></i>
                                <span class="font-medium text-gray-900 dark:text-white">Privat</span>
                            </div>
                            <p class="text-sm text-gray-500 mt-0.5">Nur Sie können dieses Dokument sehen</p>
                        </div>
                    </label>

                    <!-- Shared with specific people -->
                    <label class="flex items-start gap-3 p-3 rounded-xl border cursor-pointer transition-all"
                           :class="shareVisibility === 'shared'
                               ? 'border-primary-500 bg-primary-50 dark:bg-primary-900/20'
                               : 'border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750'">
                        <input type="radio" name="visibility" value="shared"
                               x-model="shareVisibility"
                               class="mt-0.5 text-primary-600 focus:ring-primary-500">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <i data-lucide="users" class="w-4 h-4 text-gray-500"></i>
                                <span class="font-medium text-gray-900 dark:text-white">Mit bestimmten Personen</span>
                            </div>
                            <p class="text-sm text-gray-500 mt-0.5">Teilen Sie mit ausgewählten Mitgliedern</p>
                        </div>
                    </label>

                    <!-- Organization -->
                    <label class="flex items-start gap-3 p-3 rounded-xl border cursor-pointer transition-all"
                           :class="shareVisibility === 'organization'
                               ? 'border-primary-500 bg-primary-50 dark:bg-primary-900/20'
                               : 'border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750'">
                        <input type="radio" name="visibility" value="organization"
                               x-model="shareVisibility"
                               class="mt-0.5 text-primary-600 focus:ring-primary-500">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <i data-lucide="building" class="w-4 h-4 text-gray-500"></i>
                                <span class="font-medium text-gray-900 dark:text-white">Gesamte Organisation</span>
                            </div>
                            <p class="text-sm text-gray-500 mt-0.5">Alle Mitglieder von {{ organization.name }}</p>
                        </div>
                    </label>
                </div>

                <!-- Add Person (when shared is selected) -->
                <div x-show="shareVisibility === 'shared'"
                     x-transition
                     class="pt-4 border-t border-gray-200 dark:border-gray-700">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Person hinzufügen
                    </label>
                    <div class="flex gap-2">
                        <input type="email"
                               name="add_user_email"
                               x-model="addUserEmail"
                               placeholder="E-Mail-Adresse eingeben..."
                               class="flex-1 px-4 py-2.5 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm">
                        <button type="button"
                                @click="$refs.shareForm && $refs.shareForm.submit()"
                                :disabled="!addUserEmail"
                                class="px-4 py-2.5 text-sm font-medium text-white bg-primary-600 rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">
                        <i data-lucide="info" class="w-3 h-3 inline-block mr-1"></i>
                        Der Benutzer muss bereits ein Konto haben.
                    </p>
                </div>
            </div>

            <!-- Footer -->
            <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900 flex items-center justify-between">
                <a :href="`/work/{{ organization.slug }}/motions/${shareMotionId}/share/`"
                   class="text-sm text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300">
                    Erweiterte Freigaben
                </a>
                <div class="flex items-center gap-2">
                    <button type="button"
                            @click="closeShareModal()"
                            class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700">
                        Abbrechen
                    </button>
                    <button type="submit"
                            class="px-4 py-2 text-sm font-medium text-white bg-primary-600 rounded-lg hover:bg-primary-700">
                        Speichern
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

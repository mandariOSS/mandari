{% load static %}
<!DOCTYPE html>
<html lang="de" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teleprompter - {{ agenda_item.name|default:"Tagesordnungspunkt" }}</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: system-ui, -apple-system, sans-serif;
        }
        .teleprompter-text {
            font-size: 2.5rem;
            line-height: 1.8;
            letter-spacing: 0.02em;
        }
        @media (min-width: 768px) {
            .teleprompter-text {
                font-size: 3.5rem;
            }
        }
        @media (min-width: 1024px) {
            .teleprompter-text {
                font-size: 4.5rem;
            }
        }
        .auto-scroll {
            animation: scroll linear infinite;
            animation-play-state: paused;
        }
        .auto-scroll.playing {
            animation-play-state: running;
        }
        @keyframes scroll {
            0% { transform: translateY(0); }
            100% { transform: translateY(var(--scroll-distance)); }
        }
    </style>
</head>
<body x-data="teleprompter()" class="min-h-screen">
    <!-- Controls -->
    <div class="fixed top-0 left-0 right-0 p-4 bg-gradient-to-b from-black to-transparent z-50"
         :class="showControls ? 'opacity-100' : 'opacity-0'"
         @mouseenter="showControls = true" @mouseleave="showControls = false">
        <div class="flex items-center justify-between max-w-4xl mx-auto">
            <div class="flex items-center gap-4">
                <a href="{% url 'work:meeting_prepare' org_slug=organization.slug meeting_id=meeting.id %}"
                   class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white text-sm transition-colors">
                    Zur체ck
                </a>
                <div class="text-white/60 text-sm">
                    {{ agenda_item.number }}. {{ agenda_item.name|truncatechars:40 }}
                </div>
            </div>
            <div class="flex items-center gap-4">
                <button @click="decreaseFontSize()" class="p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition-colors">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/></svg>
                </button>
                <span class="text-white/60 text-sm min-w-[4rem] text-center" x-text="fontSize + '%'"></span>
                <button @click="increaseFontSize()" class="p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition-colors">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                </button>
                <div class="h-6 w-px bg-white/20 mx-2"></div>
                <button @click="togglePlay()" class="p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition-colors">
                    <svg x-show="!isPlaying" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    <svg x-show="isPlaying" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </button>
                <input type="range" min="1" max="20" x-model="scrollSpeed" class="w-24 accent-white">
            </div>
        </div>
    </div>

    <!-- Title -->
    {% if speech_note and speech_note.title %}
    <div class="fixed top-16 left-0 right-0 text-center py-4 z-40">
        <h1 class="text-2xl md:text-3xl font-bold text-white/80">{{ speech_note.title }}</h1>
    </div>
    {% endif %}

    <!-- Main Content -->
    <div class="min-h-screen flex items-start justify-center pt-32 pb-32 px-8"
         @mouseenter="showControls = true" @mouseleave="showControls = false"
         @click="togglePlay()">
        <div class="max-w-4xl mx-auto overflow-hidden" :style="{ height: containerHeight + 'px' }">
            <div class="teleprompter-text text-center whitespace-pre-wrap leading-relaxed"
                 :style="{ fontSize: fontSize + '%', transform: 'translateY(' + scrollPosition + 'px)' }"
                 x-ref="content">{% if speech_note %}{{ speech_note.content }}{% else %}Keine Redenotizen vorhanden.

Gehen Sie zur체ck zur Sitzungsvorbereitung und erstellen Sie Redenotizen f체r diesen Tagesordnungspunkt.{% endif %}</div>
        </div>
    </div>

    <!-- Timer / Duration -->
    {% if speech_note.estimated_duration %}
    <div class="fixed bottom-4 right-4 bg-white/10 rounded-lg px-4 py-2 z-50">
        <div class="text-white/60 text-sm">Gesch채tzte Dauer</div>
        <div class="text-white text-xl font-mono">
            {{ speech_note.estimated_duration|floatformat:0 }} Sek.
        </div>
    </div>
    {% endif %}

    <!-- Keyboard hints -->
    <div class="fixed bottom-4 left-4 text-white/40 text-xs z-50" :class="showControls ? 'opacity-100' : 'opacity-0'">
        Space: Play/Pause | Up/Down: Scroll | +/-: Font Size | Esc: Exit
    </div>

    <script defer src="{% static 'vendor/alpine/alpine.min.js' %}"></script>
    <script>
        function teleprompter() {
            return {
                showControls: true,
                isPlaying: false,
                scrollPosition: 0,
                scrollSpeed: 5,
                fontSize: 100,
                containerHeight: window.innerHeight - 200,
                animationFrame: null,

                init() {
                    // Hide controls after 3 seconds
                    setTimeout(() => this.showControls = false, 3000);

                    // Keyboard shortcuts
                    document.addEventListener('keydown', (e) => {
                        if (e.key === ' ' || e.key === 'Spacebar') {
                            e.preventDefault();
                            this.togglePlay();
                        } else if (e.key === 'ArrowUp') {
                            e.preventDefault();
                            this.scrollPosition += 50;
                        } else if (e.key === 'ArrowDown') {
                            e.preventDefault();
                            this.scrollPosition -= 50;
                        } else if (e.key === '+' || e.key === '=') {
                            this.increaseFontSize();
                        } else if (e.key === '-') {
                            this.decreaseFontSize();
                        } else if (e.key === 'Escape') {
                            window.history.back();
                        }
                    });

                    // Update container height on resize
                    window.addEventListener('resize', () => {
                        this.containerHeight = window.innerHeight - 200;
                    });
                },

                togglePlay() {
                    this.isPlaying = !this.isPlaying;
                    if (this.isPlaying) {
                        this.startScrolling();
                    } else {
                        this.stopScrolling();
                    }
                },

                startScrolling() {
                    const scroll = () => {
                        if (!this.isPlaying) return;
                        this.scrollPosition -= this.scrollSpeed / 10;
                        this.animationFrame = requestAnimationFrame(scroll);
                    };
                    this.animationFrame = requestAnimationFrame(scroll);
                },

                stopScrolling() {
                    if (this.animationFrame) {
                        cancelAnimationFrame(this.animationFrame);
                    }
                },

                increaseFontSize() {
                    this.fontSize = Math.min(200, this.fontSize + 10);
                },

                decreaseFontSize() {
                    this.fontSize = Math.max(50, this.fontSize - 10);
                }
            }
        }
    </script>
</body>
</html>

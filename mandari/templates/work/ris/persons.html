{% extends "work/base_work.html" %}

{% block page_title %}Personen{% endblock %}

{% block header_title %}Personen{% endblock %}
{% block header_subtitle %}
{% if body %}
<p class="work-page-subtitle">{{ body.get_display_name }} · {{ paginator.count }} Personen</p>
{% endif %}
{% endblock %}

{% block header_actions %}
<a href="{% url 'work:ris_overview' org_slug=organization.slug %}"
   class="inline-flex items-center gap-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white">
    <i data-lucide="arrow-left" class="w-4 h-4"></i>
    Zurück
</a>
{% endblock %}

{% block work_content %}
{% if no_body_linked %}
<div class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-6 text-center">
    <i data-lucide="alert-triangle" class="w-12 h-12 mx-auto text-amber-500 mb-4"></i>
    <h3 class="text-lg font-semibold text-amber-800 dark:text-amber-200 mb-2">Keine Kommune verknüpft</h3>
</div>
{% else %}

<!-- Search -->
<div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700/50 p-6 mb-6">
    <form method="get">
        <div class="relative max-w-md">
            <input type="text" name="q" value="{{ search_query|default:'' }}"
                   placeholder="Person suchen..."
                   class="w-full px-4 py-2.5 pl-10 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-gray-900 dark:text-white placeholder-gray-400">
            <i data-lucide="search" class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
    </form>
</div>

<!-- Persons Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {% for person in persons %}
    <a href="{% url 'work:ris_person_detail' org_slug=organization.slug person_id=person.id %}"
       class="bg-white dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700/50 p-5 hover:border-primary-200 dark:hover:border-primary-700 hover:shadow-sm transition-all">
        <div class="flex items-center gap-4">
            <div class="flex-shrink-0 w-11 h-11 bg-amber-50/70 dark:bg-amber-900/20 rounded-full flex items-center justify-center">
                <i data-lucide="user" class="w-5 h-5 text-amber-500 dark:text-amber-400"></i>
            </div>
            <div class="flex-1 min-w-0">
                <p class="font-semibold text-gray-900 dark:text-white truncate">{{ person.name }}</p>
                {% if person.membership_count %}
                <p class="text-sm text-gray-500 dark:text-gray-400">{{ person.membership_count }} Gremien</p>
                {% endif %}
            </div>
        </div>
    </a>
    {% empty %}
    <div class="col-span-full">
        <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 px-5 py-12 text-center">
            <div class="w-16 h-16 mx-auto mb-4 bg-amber-100 dark:bg-amber-900/30 rounded-full flex items-center justify-center">
                <i data-lucide="users" class="w-8 h-8 text-amber-500 dark:text-amber-400"></i>
            </div>
            <p class="text-lg font-medium text-gray-900 dark:text-white mb-1">Keine Personen gefunden</p>
            <p class="text-sm text-gray-500 dark:text-gray-400">Versuche andere Suchbegriffe.</p>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% if persons.has_other_pages %}
<div class="mt-6 flex items-center justify-center gap-1">
    {% if persons.has_previous %}
    <a href="?page={{ persons.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}"
       class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
        <i data-lucide="chevron-left" class="w-5 h-5"></i>
    </a>
    {% endif %}

    {% for num in persons.paginator.page_range %}
    {% if persons.number == num %}
    <span class="px-3 py-2 bg-primary-100 dark:bg-primary-900 text-primary-600 dark:text-primary-400 rounded-lg font-medium text-sm">{{ num }}</span>
    {% elif num > persons.number|add:'-3' and num < persons.number|add:'3' %}
    <a href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}"
       class="px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm">{{ num }}</a>
    {% endif %}
    {% endfor %}

    {% if persons.has_next %}
    <a href="?page={{ persons.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}"
       class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
        <i data-lucide="chevron-right" class="w-5 h-5"></i>
    </a>
    {% endif %}
</div>
{% endif %}
{% endif %}
{% endblock %}
